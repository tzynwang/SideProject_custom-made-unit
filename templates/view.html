{% extends "layout.html" %}

{% block title %}
    瀏覽||編輯
{% endblock %}

{% block main %}
    <div class="" role="alert" id="hintBox"><span id="hintText"></span></div>

    <div id="search">
        <input class="form-control" type="date" name="start" id="start" onchange="setMin()">
        至
        <input class="form-control" type="date" name="end" id="end">
        {% for k, v in groupName %}
        <div class="pretty p-default p-round" name="selectedGroup">
            <input type="checkbox" value="{{ v }}" id="{{ k }}" checked>
            <div class="state p-primary-o">
                <label for="{{ k }}">{{ v }}</label>
            </div>
        </div>
        {% endfor %}

        <button class="btn btn-primary" type="button" onclick="sendTime()">篩選</button>
    </div>
    
    <br>
    <div id="editForm">
        <input class="form-control" type="date" id="ediDate">
        <select class="form-control" id="ediGroup">
            <option selected value="">組別</option>
            {% for k, v in groupName %}
            <option value="{{ k }}">{{ v }}</option>
            {% endfor %}
        </select>
        <input class="form-control" type="text" id="ediNote" maxlength="32" size="32" 
        placeholder="花費內容 (最多32中文字)" autocomplete="off">
        <input class="form-control" type="number" id="ediAmount" min="1" style="width: 7em" 
        placeholder="金額" autocomplete="off">
        
        <button class="btn btn-primary" id="toUpdate">修改</button>
        <button class="btn btn-secondary" onclick="cancelEdit()">算了</button>
        <i class="fas fa-trash-alt fa-lg" id="trashIcon" style="color:#6c757d" 
        data-toggle="modal" data-target="#deleteConfirm"></i>
    </div>
    <br>

    <table class="table table-sm" id="result">
        <thead>
            <th scope="col" onclick="sort()">日期</th>
            <th scope="col">組別</th>
            <th scope="col">花費內容</th>
            <th scope="col">金額</th>
        </thead>
        <tbody id="row"></tbody>
        <tfoot id="subTotal"></tfoot>
    </table>
    <input type="hidden" id="order" value="asc">

    {# delete row confirm dialog box #}
    <div class="modal fade" id="deleteConfirm" tabindex="-1" role="dialog" aria-labelledby="deleteRowLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="deleteRowLabel">確定嗎？</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    真的要刪掉這筆紀錄嗎？<br>
                    提醒：資料刪掉後是無法復原的 (;ﾟдﾟ)σ
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="closed">算了</button>
                    <button type="button" class="btn btn-primary" onclick="deleteBill()">確定刪除</button>
                </div>
            </div>
        </div>
    </div>
<<<<<<< HEAD
    
    <script>
        $(document).ready(
            $("#hintBox").hide(),
            $("#result").hide(),
            $("#editForm").hide()
        );

        function setMin() {
            $("#end").val("");
            $("#end").attr({
                "min": $("#start").val()
            });
        }

        var tdName = ["null","ediDate","ediGroup","ediNote","ediAmount"];
        function sendTime() {
            $("#result").val("");
            var start = $("#start").val();
            var end = $("#end").val();
            if (!start || !end) {
                $("#hintText").html("請設定查詢範圍");
                $("#hintBox").attr("class","alert alert-info");
                $("#hintBox").show();
            }
            else {
                $.ajax({
                    url: "/filter",
                    type: "POST",
                    data: JSON.stringify({"start":start, "end":end}),
                    dataType: "json",
                    contentType: "application/json",
                    success: function(result) {
                        if(!result) {
                            $("#hintText").html("此日期區間沒有記帳紀錄");
                            $("#hintBox").attr("class","alert alert-warning");
                            $("#hintBox").show();
                        }
                        else {
                            $("#hintBox").hide();
                            $("#row").empty();
                            $("#subTotal").empty();
                            $("#result").show();                           
                            var billSum = 0;
=======
>>>>>>> 2c03be9b9ed71514a8c3915f149e7df35994ad0c

    {# group filter dialog box #}
    <div class="modal fade" id="groupInTable" tabindex="-1" role="dialog" aria-labelledby="groupFilterLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="groupFilterLabel">組別篩選</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="gFilterBody"></form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="">顯示已勾選的組別</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="closed">算了</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        Icons by <a href="https://fontawesome.com/">fontawesome.com</a> is licensed under <a href="https://fontawesome.com/license">CC BY 4.0</a>
    </footer>
    
    <script src="/static/view-js.js?version=14"></script>

<<<<<<< HEAD
        $("#trashIcon").click(function() {
            var answer = confirm("確定要刪除這一行紀錄嗎?\n提醒：被刪掉的資料無法復原");
            if (answer == true) {
                // ajax send tr id to backend for delete
                $.ajax({
                    url: "/billDelete",
                    type: "POST",
                    data: JSON.stringify({"id": trID}),
                    contentType: "application/json",
                    success: function(result) {
                        $("#"+trID).remove();
                        trID = null;
                    }
                });
            }
        });

=======
    <script>
>>>>>>> 2c03be9b9ed71514a8c3915f149e7df35994ad0c
        function sort() {
            var table = $('#result');
            var tbody = $('#row');
            tbody.find('tr').sort(function(a, b) {
                if ($('#order').val() == 'asc') {
                    return $('td:first', a).text().localeCompare($('td:first', b).text());
                }
                else {
                    return $('td:first', b).text().localeCompare($('td:first', a).text());
                }
            }).appendTo(tbody);

            var sort_order = $('#order').val();
            if (sort_order =="asc") {
                $('#order').val("desc");
            }
            if (sort_order =="desc") {
                $('#order').val("asc");
            }
        }
    </script>
{% endblock %}